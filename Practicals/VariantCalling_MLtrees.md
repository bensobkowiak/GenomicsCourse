# Genomic Analysis and Phylodynamics Workshop

## Practical Session 2 - Variant calling and maximum likelihood trees


Objectives
---

By the end of this activity, you will be able to:<br>
<br>
• Call variants from alignments (SNPs, Indels)<br>
• Variant filtering and QC <br>
• Build SNP matrices and consensus sequences <br>
• Align consensus sequences <br>
• Build Maximum Likelihood phylogenetic trees 


Required Programs
---

SAMtools/BCFtools <br>
GATK <br>
Extended Text Viewer (e.g. BBEdit, Notepad++, etc.) <br>
R <br>
mafft <br>
IQtree <br>
FigTree <br>
AliView (optional) <br> 


## Activities

[1. Variant calling and the VCF format](VariantCall.md)<br>
<br>
[2. Filter variants and construct consensus sequences and SNP matrices](Consensus_sequence.html)<br>
<br>
[3. Align consensus sequences](Align_consensus.md)<br>
<br>
[4. Maximum Likelihood phylogenetic trees](MLtrees.md)<br>


Background
---

Genomic variation within pathogenic organisms play a pivotal role in shaping their characteristics, including virulence, drug resistance, and host adaptation, all of which influence the transmission dynamics of infectious diseases. These variants can occur as single nucleotide polymorphisms (SNPs), insertions, deletions, or structural changes in the pathogen's DNA. Investigating genomic variants is crucial for understanding the evolution of pathogens, tracking the emergence of drug-resistant strains, and designing targeted interventions to combat infectious diseases. Furthermore, comparing the genetic differences among pathogen strains enables the tracing of transmission pathways, helping to identify the source of infections, map the dynamics of disease spread, and inform targeted public health interventions. Genomic epidemiology, fueled by advancements in high-throughput sequencing technologies, has become a powerful tool in understanding infectious disease transmission and enhancing our ability to control and prevent outbreaks.

Variant calling involves the computational analysis of sequencing data to pinpoint variation within the genome. After aligning sequencing reads to a reference genome, specialized variant calling algorithms can detect variation. Variant calling software, such as SAMtools and GATK (Genome Analysis Toolkit), plays a crucial role by automating the identification of genetic variants from high-throughput sequencing data. These tools are indispensable for extracting meaningful information from the vast amount of data generated by modern sequencing technologies. The significance of these tools lies in their capacity to handle complex tasks, including the identification of SNPs and Indels, while accounting for various factors such as sequencing errors and base quality scores. The utilization of variant calling software not only expedites the analysis process but also ensures the reliability of identified variants. It is then possible to build consensus sequences from variant calling output by determining most likely nucleotide at each position and incorporating identified variants, which provides a representative sequence for each sample for downstream analyses. 

Maximum Likelihood (ML) phylogenetic trees can provide a powerful and statistically rigorous approach to infer evolutionary relationships among taxa. These trees are constructed by evaluating different possible evolutionary scenarios and selecting the one that maximizes the likelihood of observed sequences given a model of evolution. ML methods consider parameters such as substitution rates, branch lengths, and the probability of different nucleotide or amino acid changes, allowing for the estimation of the most likely tree topology. ML trees are statistically well-supported, offering insights into the evolutionary history of organisms or sequences. These trees help us to reveal the branching patterns and divergence times among species, providing a framework to understand genetic relationships and evolutionary processes underlying the input sequences. Furthermore, ML trees are essential for comparative genomics, molecular epidemiology, and the identification of genes under positive selection, contributing to advancements in various biological disciplines and helping to interpret complex biological data.

In this practical, we will carry out variant calling on multiple aligned sequence data files in the BAM format to identify SNPs and Indels in these samples. The variant calling software we will use is [GATK](https://gatk.broadinstitute.org/hc/en-us), developed by the Broad Institute, which is renowned for its advanced algorithms that address issues such as base quality recalibration and local realignment, enhancing the accuracy of variant calls. Other software can be used to call variants, including [SAM/BCFtools](http://www.htslib.org), [Pilon](https://github.com/broadinstitute/pilon/wiki), and [FreeBayes](https://github.com/freebayes/freebayes). These software will use different models to identify variants and may be more or less accurate depending on the data. After variant calling we will understand the Variant Call Format (VCF) file, the standardized file format that is produced from variant calling software, and use perform some QC steps in R to build a consensus sequence for all samples, including SNP variation between individuals. We will also run a quick tutorial to align consensus sequences that have already been constructed, perhaps using different reference genomes or through _de novo_ assembly, such as SARS-CoV-2 sequences that are  downloaded from GISAID. Finally, we will build a Maximum Likelihood phylogeny using aligned consensus sequences with [IQtree](http://www.iqtree.org) to infer the evolutionary relationship between the samples.

## Resources for further reading

### Genomic variants: <br>

[SNPs](https://medlineplus.gov/genetics/understanding/genomicresearch/snp/) <br>
[Indels](https://www.sciencedirect.com/topics/biochemistry-genetics-and-molecular-biology/indel) <br>
[Structural variants](https://www.ncbi.nlm.nih.gov/dbvar/content/overview/) <br>

### Phylogenetic trees: <br>

https://www.khanacademy.org/science/ap-biology/natural-selection/phylogeny/a/phylogenetic-trees <br>

